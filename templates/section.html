{% extends "layout.html" %}

{% block title %}{{ section_item.title }} — ВПФК{% endblock %}

{% block content %}
  <section class="section">
    <div class="container">
      <div class="section-header">
        <h1>{{ section_item.title }}</h1>
        <a class="link" href="{{ url_for('articles') }}">Усі статті</a>
      </div>

      {% if section_item.children %}
        <div class="subsection-list">
          {% for child in section_item.children %}
            <a class="subsection-chip" href="{{ child.url }}">{{ child.title }}</a>
          {% endfor %}
        </div>
      {% endif %}

      <div class="article-list">
        {% for article in articles %}
          <article class="article-card">
            {% set thumb = article.featured_image %}
            {% if not thumb and article.image_gallery %}
              {% set gallery = article.image_gallery|from_json if article.image_gallery else [] %}
              {% if gallery %}
                {% set thumb = gallery[0] %}
              {% endif %}
            {% endif %}
            {% if thumb %}
              {% if article.external_link %}
                <a class="article-thumb" href="{{ article.external_link }}" target="_blank">
                  <img src="{{ uploads_url(thumb) }}" alt="{{ article.title }}">
                </a>
              {% else %}
                <a class="article-thumb" href="{{ url_for('article_detail', article_id=article.id) }}">
                  <img src="{{ uploads_url(thumb) }}" alt="{{ article.title }}">
                </a>
              {% endif %}
            {% endif %}
            <div class="article-meta">
              <span class="badge">{{ article.category }}</span>
              <span class="muted">Публікація: {{ article.published_date }}</span>
              {% if article.event_date %}
                <span class="muted">Подія: {{ article.event_date }}</span>
              {% endif %}
            </div>
            <h3>
              {% if article.external_link %}
                <a href="{{ article.external_link }}" target="_blank">{{ article.title }}</a>
              {% else %}
                <a href="{{ url_for('article_detail', article_id=article.id) }}">{{ article.title }}</a>
              {% endif %}
            </h3>
            {% set summary_text = article.summary|clean_text %}
            {% if summary_text %}
              <p>{{ summary_text }}</p>
            {% endif %}
            <div class="article-footer">
              {% if article.external_link %}
                <a class="link" href="{{ article.external_link }}" target="_blank">Перейти</a>
              {% else %}
                <a class="link" href="{{ url_for('article_detail', article_id=article.id) }}">Читати</a>
              {% endif %}
            </div>
          </article>
        {% else %}
          <div class="empty-state">У цьому розділі поки немає статей.</div>
        {% endfor %}
      </div>
    </div>
  </section>
{% endblock %}
