{% extends "layout.html" %}

{% block title %}{{ article.title }} — ВПФК{% endblock %}

{% block content %}
  <section class="section">
    <div class="container article-detail">
      <div class="article-meta">
        <span class="badge">{{ article.category }}</span>
        <span class="muted">Публікація: {{ article.published_date }}</span>
        {% if article.event_date %}
          <span class="muted">Подія: {{ article.event_date }}</span>
        {% endif %}
      </div>
      <div class="article-publish-pill">
        <span>Опубліковано:</span>
        {% set author_name = article.author_full_name|trim if article.author_full_name else '' %}
        {% if article.author_username %}
          <a href="{{ url_for('user_profile', username=article.author_username) }}">{{ author_name or article.author_username }}</a>
        {% else %}
          <span>{{ author_name or 'Користувач' }}</span>
        {% endif %}
        <span>·</span>
        <span>{{ article.created_at[:10] if article.created_at else article.published_date }}</span>
      </div>
      <h1>{{ article.title }}</h1>
      
      <!-- Featured Image -->
      {% if article.featured_image %}
        <div class="article-featured-image" style="margin-bottom: 20px;">
          <img src="{{ uploads_url(article.featured_image) }}" 
               style="width: 100%; max-height: 600px; object-fit: contain; border-radius: 8px; background: #f8fafc;" 
               alt="{{ article.title }}">
        </div>
      {% endif %}
      
      {% set summary_text = article.summary|clean_text %}
      {% if summary_text %}
        <p class="article-summary">{{ summary_text }}</p>
      {% endif %}
      <div class="article-content">
        {{ article.content|sanitize_html|safe }}
      </div>
      
      <!-- Image Gallery -->
      {% if article.image_gallery %}
        {% set gallery = article.image_gallery|from_json if article.image_gallery else [] %}
        {% if gallery %}
          <div class="article-gallery" style="margin-top: 30px;">
            <h3>Галерея зображень</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
              {% for img_path in gallery %}
                <img src="{{ uploads_url(img_path) }}" 
                     style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px; cursor: pointer;" 
                     alt="Gallery {{ loop.index }}"
                     onclick="openImageModal('{{ uploads_url(img_path) }}', '{{ article.title }} - Image {{ loop.index }}')">
              {% endfor %}
            </div>
          </div>
        {% endif %}
      {% endif %}
      <div class="article-footer">
        {% if article.section_title %}
          <span class="muted">{{ article.section_title }}</span>
        {% endif %}
        <a class="link" href="{{ url_for('articles') }}">До всіх статей</a>
      </div>
    </div>
  </section>
  
  <!-- Image Modal -->
  <div id="imageModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9);">
    <span onclick="closeImageModal()" style="position: absolute; top: 20px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer;">&times;</span>
    <img id="modalImage" style="margin: auto; display: block; width: 80%; max-width: 700px; max-height: 80%; margin-top: 50px; object-fit: contain;">
    <div id="modalCaption" style="margin: auto; display: block; width: 80%; max-width: 700px; text-align: center; color: #ccc; padding: 10px 0; height: 150px;"></div>
  </div>
{% endblock %}

{% block scripts %}
<script>
function openImageModal(src, alt) {
  document.getElementById('imageModal').style.display = 'block';
  document.getElementById('modalImage').src = src;
  document.getElementById('modalCaption').innerHTML = alt;
}

function closeImageModal() {
  document.getElementById('imageModal').style.display = 'none';
}

// Close modal when clicking outside the image
window.onclick = function(event) {
  const modal = document.getElementById('imageModal');
  if (event.target == modal) {
    closeImageModal();
  }
}
</script>
{% endblock %}
